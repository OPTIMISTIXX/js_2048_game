function t(t){return t&&t.__esModule?t.default:t}var e={};class s{static Status={idle:"idle",playing:"playing",win:"win",lose:"lose"};constructor(t=Array.from({length:4},()=>[,,,,].fill(0))){this.state=[...t],this.status=s.Status.idle,this.score=0,this.initialState=[...t],this.undoStack=[]}getScore(){return this.score}getState(){return this.state}getStatus(){return this.updateStatus(),this.status}start(){this.status=s.Status.playing,this.state=this.initialState.concat(),this.createRandomTile(),this.createRandomTile(),this.printTiles()}restart(){this.clearTheBoard(),this.printTiles(),this.status=s.Status.idle,this.score=0,this.undoStack=[]}moveRight(){if(this.status!==s.Status.playing)return;this.saveState();let t=!1;for(let e=0;e<4;e++){let s=!1;for(let i=2;i>=0;i--)if(this.state[e][i]>0){let a=0,r=!1;for(;0===this.state[e][i+a+1];)a++;if(s||this.state[e][i+a+1]!==this.state[e][i]||(a++,r=!0),a>0){if(!s&&r){s=!0;let t=2*this.state[e][i+a];this.state[e][i+a]=t,this.score+=t}else s=!1,this.state[e][i+a]=this.state[e][i];this.state[e][i]=0,t=!0}}}return t&&this.createRandomTile(),t}moveLeft(){if(this.status!==s.Status.playing)return;this.saveState();let t=!1;for(let e=0;e<4;e++){let s=!1;for(let i=1;i<4;i++)if(this.state[e][i]>0){let a=0,r=!1;for(;0===this.state[e][i-a-1];)a++;if(s||this.state[e][i-a-1]!==this.state[e][i]||(a++,r=!0),a>0){if(!s&&r){s=!0;let t=2*this.state[e][i-a];this.state[e][i-a]=t,this.score+=t}else s=!1,this.state[e][i-a]=this.state[e][i];this.state[e][i]=0,t=!0}}}return t&&this.createRandomTile(),t}moveUp(){if(this.status!==s.Status.playing)return;this.saveState();let t=!1;for(let e=0;e<4;e++){let s=!1;for(let i=1;i<4;i++)if(this.state[i][e]>0){let a=0,r=!1;for(;i-a-1>=0&&0===this.state[i-a-1][e];)a++;if(!s&&i-a-1>=0&&this.state[i-a-1][e]===this.state[i][e]&&(a++,r=!0),a>0){if(!s&&r){s=!0;let t=2*this.state[i-a][e];this.state[i-a][e]=t,this.score+=t}else s=!1,this.state[i-a][e]=this.state[i][e];this.state[i][e]=0,t=!0}}}return t&&this.createRandomTile(),t}moveDown(){if(this.status!==s.Status.playing)return;this.saveState();let t=!1;for(let e=0;e<4;e++){let s=!1;for(let i=2;i>=0;i--)if(this.state[i][e]>0){let a=0,r=!1;for(;i+a+1<this.state.length&&0===this.state[i+a+1][e];)a++;if(!s&&i+a+1<this.state.length&&this.state[i+a+1][e]===this.state[i][e]&&(a++,r=!0),a>0){if(!s&&r){s=!0;let t=2*this.state[i+a][e];this.state[i+a][e]=t,this.score+=t}else s=!1,this.state[i+a][e]=this.state[i][e];this.state[i][e]=0,t=!0}}}return t&&this.createRandomTile(),t}saveState(){let t=this.state.map(t=>t.slice());this.undoStack.push(t)}undo(){return this.undoStack.length>0&&(this.state=this.undoStack.pop(),this.printTiles(),!0)}createRandomTile(){let t=this.randomNumber(3);for(;!this.state[t].includes(0);)t=this.randomNumber(3);let e=this.randomNumber(3);for(;0!==this.state[t][e];)e=this.randomNumber(3);let s=this.state.map(t=>t.slice());s[t][e]=this.generateCellValue(),this.state=s,this.printTiles()}randomNumber(t){return Math.round(Math.random()*t)}generateCellValue(){return Math.random()>.9?4:2}updateStatus(){this.didPlayerWin()?this.status=s.Status.win:this.didPlayerLose()&&(this.status=s.Status.lose)}didPlayerWin(){for(let t of this.state.flat())if(2048===t)return!0;return!1}didPlayerLose(){for(let t of this.state.flat())if(0===t)return!1;for(let t=0;t<=3;t++)for(let e=0;e<=2;e++)if(this.state[t][e]===this.state[t][e+1])return!1;for(let t=0;t<=3;t++)for(let e=0;e<=2;e++)if(this.state[e][t]===this.state[e+1][t])return!1;return!0}printTiles(){let t=document.getElementsByClassName("field-cell"),e=this.state.flat();for(let s=0;s<e.length;s++){let i=t[s],a=e[s];a>0?void 0!==i&&(i.textContent=a,i.className=`field-cell field-cell--${a}`):void 0!==i&&(i.textContent="",i.className="field-cell")}}clearTheBoard(){this.state=this.initialState.concat()}}const i=new(t(e=s)),a=document.querySelector(".start"),r=document.querySelector(".game-score"),l=document.querySelector(".message-lose"),n=document.querySelector(".message-win"),h=document.querySelector(".message-start"),o=document.querySelector(".undo");function u(s){s.preventDefault();let a=!1;switch(s.key){case"ArrowUp":a=i.moveUp();break;case"ArrowDown":a=i.moveDown();break;case"ArrowRight":a=i.moveRight();break;case"ArrowLeft":a=i.moveLeft()}if(a){d(i.getScore());let s=i.getStatus();s===t(e).Status.lose?l.classList.remove("hidden"):s===t(e).Status.win&&n.classList.remove("hidden")}}function d(t){r.textContent=t}a.addEventListener("click",()=>{a.classList.contains("start")?(a.className="button restart",a.textContent="Restart",h.classList.add("hidden"),i.start()):(a.className="button start",a.textContent="Start",h.classList.remove("hidden"),n.classList.add("hidden"),l.classList.add("hidden"),document.removeEventListener("keydown",u),i.restart()),document.addEventListener("keydown",u)}),o.addEventListener("click",()=>{l.classList.add("hidden"),i.undo(),d(i.getScore())});
//# sourceMappingURL=index.0576a41d.js.map
